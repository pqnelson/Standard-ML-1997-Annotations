\ProvidesPackage{halftitle}[2024/07/31 Half-title page]

%% This is a generic "half-title" page, with stuff commented out
%% which is irrelevant for the current endeavour.

\newif\ifincludegitrevision\includegitrevisionfalse

% The [git] option will print the git version info [abbreviated commit
% and timestamp] on its own line in the half-title page.
\DeclareOption{git}{
  \includegitrevisiontrue
}

\ProcessOptions\relax
\RequirePackage{hologo}

\ifincludegitrevision
  % redefine this parameter with whatever file contains the git revision
  % information 
  \def\gitrevisionfile{revision} % revision.tex
  
  %% Printing the [abbreviated] git commit and date
  \expandafter\input\gitrevisionfile % autogenerated in definitions in this file
  % \endparsegitdate needed to capture #8 fully :(
  \def\parsegitdate#1-#2-#3T#4:#5:#6-#7:#8\endparsegitdate{
    \DTMDisplay{#1}{#2}{#3}{-1}{#4}{#5}{#6}{-#7}{#8}
  }
  \def\thegitdate{\ifdefempty{\revisiondate}{}{%
    \expandafter\parsegitdate\revisiondate\endparsegitdate%
  }}
\fi
  
%% Half-title page
%% I'm sure there's a way to turn this into its own package, but I do
%% not need that much power!

% We want to use the title in the half-title page. This requires saving
% the \@title value, which is no longer defined after \maketitle has
% been called. We therefore need to check if \title has been called (and
% if so, just save the contents of \@title into \thetitle) or not (in
% which case, we hack \title to also save the title in \thetitle).
\def\default@title{\@latex@error{No \noexpand\title given}\@ehc}

\ifdefequal{\@title}{\default@title}{%
  \global\let\og@title\title%
  \gdef\title#1{\gdef\thetitle{#1}\og@title{#1}}%
}{%
  \xdef\thetitle{\@title} % \@title is undefined after the title page
}

% AMS subject class, optional argument for the year --- defaults to 2020.
\newcommand\subjclass[2][2020]{\gdef\math@subject@classes{#2}
  \gdef\math@subject@year{#1}}

\def\draftprintingline{{\sl Draft printing, \ifcase \month \or January\or February\or March\or April\or May\or June\or July\or August\or September\or October\or November\or December\fi \space \number\year.}}

\long\def\makehalftitle{{\eightpoint%
\@ifundefined{math@subject@classes}{}{
  \noindent Mathematics Subject ClassiÔ¨Åcation (MSC \math@subject@year):\quad\math@subject@classes}

%% \bigskip\medskip
%% \noindent
%% {\bf Suggested Library of Congress cataloging data}

%% \medskip

%% {\tt\halign{##\hfil\cr
%% Nelson, Alexander M., 1988-\cr
%% \ \ \  \thetitle.\cr
%% \noalign{\medskip}
%% \ \ \  Includes index.\cr
%% \ \ \  1.~ML (Computer program language).\ \ I.~Title.\cr
%% }}
\vfill
\noindent
\draftprintingline
\smallbreak
\noindent
Copyright $\copyright$ \number\year, Alexander M.\ Nelson.
%% \smallbreak
%% \noindent
%% All rights reserved.
%% \smallbreak
%% \noindent
%% The author hereby grants permission to print this book draft for personal use.

%% \noindent
%% Public redistribution of this book draft in PDF or other electronic form on the Internet is forbidden.

%% \noindent
%% Public distribution of this book draft in printed form is forbidden.

\noindent
You may not charge any fee for copies of this book draft.
\smallbreak
\noindent
Compiled:\enspace\today\ at \textsc{\DTMcurrenttime}\ (\DTMcurrentzone)
\smallbreak
\noindent
This book was typeset by the author using the \LaTeX\ typesetting system.

%% \noindent
%% The illustrations in this book were created by the author with \Hologo{METAPOST}.
\ifincludegitrevision\smallbreak
\noindent
This revision: \texttt{\revision}. \thegitdate.\fi}}



\endinput